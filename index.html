<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>متتبع اللياقة (نسخة مصقولة)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <style>
    :root {
      --primary-color: #3498db;
      --primary-color-darker: #2980b9;
      --primary-color-light: #eaf5fc;
      --completed-color: #2ecc71;
      --completed-color-glow: hsla(145, 63%, 49%, 0.5);
      --danger-color: #e74c3c;
      --font-family: 'Tajawal', sans-serif;
      
      /* Light Theme Colors */
      --bg-color-light: #f8f9fa;
      --surface-color-light: #ffffff;
      --on-surface-color-light: #212529;
      --on-surface-variant-light: #6c757d;
      --border-color-light: #e9ecef;
      --shadow-color-light: rgba(0, 0, 0, 0.05);
      --completed-bg-light: #eafaf1;

      /* Dark Theme Colors */
      --bg-color-dark: #1a1a1a;
      --surface-color-dark: #2c2c2c;
      --on-surface-color-dark: #f8f9fa;
      --on-surface-variant-dark: #adb5bd;
      --border-color-dark: #3e3e3e;
      --shadow-color-dark: rgba(0, 0, 0, 0.15);
      --completed-bg-dark: #1f3e2e;
    }

    html {
      --bg-color: var(--bg-color-light);
      --surface-color: var(--surface-color-light);
      --on-surface-color: var(--on-surface-color-light);
      --on-surface-variant: var(--on-surface-variant-light);
      --border-color: var(--border-color-light);
      --shadow-color: var(--shadow-color-light);
      --completed-bg: var(--completed-bg-light);
    }
    html.dark {
      --bg-color: var(--bg-color-dark);
      --surface-color: var(--surface-color-dark);
      --on-surface-color: var(--on-surface-color-dark);
      --on-surface-variant: var(--on-surface-variant-dark);
      --border-color: var(--border-color-dark);
      --shadow-color: var(--shadow-color-dark);
      --completed-bg: var(--completed-bg-dark);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      font-family: var(--font-family);
      background-color: var(--bg-color);
      color: var(--on-surface-color);
      transition: background-color 0.3s, color 0.3s;
      margin: 0;
      padding: 0;
    }
    
    .container { max-width: 800px; margin: 0 auto; padding: 20px 15px 50px 15px; }

    /* Animations */
    @keyframes fade-in {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .main-header, .selectors-container, .card, .day-content > div, .weight-chart-container, .motivational-quote {
        animation: fade-in 0.4s ease-out forwards;
        opacity: 0;
    }
    .main-header { animation-delay: 0.1s; }
    .selectors-container { animation-delay: 0.2s; }
    .motivational-quote { animation-delay: 0.25s; }


    /* Header */
    .main-header {
        position: relative;
        padding-top: 10px;
        margin-bottom: 25px;
    }
    .theme-switcher {
        position: absolute; top: 0; left: 0; z-index: 10;
        cursor: pointer; font-size: 1.4rem; width: 44px; height: 44px;
        display: flex; align-items: center; justify-content: center;
        color: var(--on-surface-variant); background: var(--surface-color); border: 1px solid var(--border-color);
        border-radius: 50%; box-shadow: 0 2px 8px var(--shadow-color);
    }
    .theme-switcher .ph-sun { display: none; }
    html.dark .theme-switcher .ph-sun { display: block; }
    html.dark .theme-switcher .ph-moon { display: none; }

    /* NEW: Rectangular & Distinct Weight Card */
    .weight-display-card {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        background: linear-gradient(to left, var(--primary-color-darker), var(--primary-color));
        color: white;
        padding: 20px 25px;
        border-radius: 18px;
        box-shadow: 0 8px 25px -5px rgba(52, 152, 219, 0.4);
    }
    .weight-card-main {
        display: flex;
        align-items: baseline;
        gap: 8px;
    }
    .weight-display-card .value {
        font-size: 3rem;
        font-weight: 800;
        line-height: 1;
    }
    .weight-display-card .unit {
        font-size: 1.2rem;
        font-weight: 500;
    }
    .weight-card-label {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 0.9rem;
        opacity: 0.9;
    }
    .weight-card-label i {
        font-size: 1.8rem;
    }


    /* Selectors */
    .selectors-container {
        background: var(--surface-color);
        padding: 15px; margin: 25px 0;
        border-radius: 18px; box-shadow: 0 4px 12px var(--shadow-color);
    }
    .week-selector {
        display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 20px;
    }
    .week-btn {
        border: none; background: var(--bg-color); color: var(--on-surface-variant); padding: 12px 5px;
        border-radius: 12px; cursor: pointer; transition: all 0.2s ease; font-weight: 700;
        font-size: 0.9rem;
    }
    .week-btn.active {
        background: var(--primary-color); color: white;
        box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3); transform: translateY(-2px);
    }
    /* FIX: Added padding to prevent glow from being clipped */
    .day-selector {
        display: flex;
        overflow-x: auto;
        padding: 5px 0 15px 0; /* Added vertical padding */
        margin-bottom: -15px; /* Adjusted negative margin */
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
    }
    .day-selector::-webkit-scrollbar { display: none; }
    
    .day-btn {
        flex: 0 0 auto; min-width: 75px; padding: 10px; margin-left: 8px;
        border: 1px solid var(--border-color); background: var(--surface-color);
        color: var(--on-surface-variant); border-radius: 12px; cursor: pointer;
        transition: all 0.2s ease; font-size: 0.9rem; font-weight: 600; text-align: center;
        position: relative;
    }
    .day-btn:first-child { margin-right: 0; }
    
    .day-btn .day-name::after {
        content: ' ';
        font-size: 0.7em;
        margin-right: 4px;
        color: var(--completed-color);
        transition: all 0.3s ease;
    }
    .day-btn.day-fully-completed .day-name::after { content: '⭐'; }

    .day-btn .day-name { font-weight: 700; }
    .day-btn .day-progress {
        width: 100%; height: 4px; border-radius: 2px;
        background-color: var(--border-color); margin-top: 8px; overflow: hidden;
    }
    .day-btn .day-progress-bar {
        width: 0; height: 100%; background-color: var(--completed-color);
        transition: width 0.4s ease;
    }
    .day-btn.active {
        background: var(--primary-color-light); color: var(--primary-color);
        border-color: var(--primary-color);
    }

    .day-btn.day-fully-completed {
        background-color: var(--completed-bg);
        border: 1px solid var(--completed-color);
        color: var(--completed-color);
        box-shadow: 0 0 12px var(--completed-color-glow);
        transform: translateY(-2px);
    }

    /* Content Area */
    .day-content { animation: fade-in 0.3s ease; }
    
    /* FIX: Motivational Quote Style for both themes */
    .motivational-quote {
        text-align: center;
        color: var(--primary-color);
        background-color: var(--primary-color-light);
        margin: 0 0 25px 0;
        font-size: 1.1rem;
        font-weight: 700;
        padding: 12px;
        border-radius: 12px;
    }
    html.dark .motivational-quote {
        background-color: var(--surface-color-dark);
        border: 1px solid var(--border-color-dark);
        border-right: 4px solid var(--primary-color);
        text-align: right;
        padding-right: 15px;
    }


    .section-title { font-size: 1.3rem; font-weight: 700; margin: 30px 0 15px; display: flex; align-items: center; gap: 10px; }
    .section-title i { color: var(--primary-color); font-size: 1.4rem; }

    .card {
        background: var(--surface-color); border-radius: 15px; padding: 18px;
        margin-bottom: 12px; display: flex; align-items: center;
        border: 1px solid var(--border-color);
        transition: transform 0.2s, box-shadow 0.2s, background-color 0.3s;
    }
    .card.completed {
        background-color: var(--completed-bg);
        border-color: var(--completed-color);
    }
    .card.completed label span { text-decoration: line-through; color: var(--on-surface-variant); }
    .card label { display: flex; align-items: center; width: 100%; cursor: pointer; }
    .card label span { font-weight: 500; font-size: 1rem; }
    .card input[type="checkbox"] {
        margin-left: 15px; width: 22px; height: 22px; cursor: pointer; flex-shrink: 0; appearance: none;
        border-radius: 6px; background: var(--bg-color); border: 1px solid var(--border-color);
        position: relative; transition: all 0.2s ease;
    }
    .card input[type="checkbox"]:checked { background: var(--primary-color); border-color: var(--primary-color); }
    .card input[type="checkbox"]:checked::before {
        content: ''; position: absolute; top: 5px; left: 3px; width: 12px; height: 6px;
        border: 2px solid white; border-top: none; border-right: none; transform: rotate(-45deg);
    }

    .workout-link {
        margin-right: auto;
        color: var(--danger-color);
        font-size: 1.5rem;
        text-decoration: none;
        opacity: 0.7;
        transition: opacity 0.2s;
    }
    .workout-link:hover { opacity: 1; }
    
    .options-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; margin-bottom: 15px; }
    .option-btn {
        border: 1px solid var(--border-color); background: var(--surface-color); color: var(--on-surface-color);
        font-weight: 600; padding: 12px 0; border-radius: 12px; cursor: pointer; transition: all 0.2s;
    }
    .option-btn:active { transform: scale(0.95); }
    .option-btn.reset-btn { color: var(--danger-color); }

    .water-progress { background: var(--bg-color); height: 25px; border-radius: 12.5px; overflow: hidden; position: relative; border: 1px solid var(--border-color); }
    .water-fill { height: 100%; background: var(--primary-color); width: 0%; border-radius: 12.5px; transition: width 0.5s ease; }
    .water-progress.completed .water-fill { background: var(--completed-color); }
    .water-text { position: absolute; width: 100%; text-align: center; line-height: 25px; color: var(--on-surface-variant); font-weight: 600; font-size: 0.8rem; }
    .water-progress.completed .water-text { color: white; text-shadow: 0 1px 1px rgba(0,0,0,0.2); }

    .input-area {
        display: flex; align-items: center; background: var(--surface-color); border: 1px solid var(--border-color);
        border-radius: 15px; padding: 8px 15px; margin-top: 15px;
    }
    .input-area:focus-within { border-color: var(--primary-color); box-shadow: 0 0 0 3px var(--primary-color-light); }
    .input-area i { color: var(--on-surface-variant); font-size: 1.5rem; margin-left: 10px; }
    .input-area input { flex-grow: 1; border: none; background: none; padding: 8px 0; color: var(--on-surface-color); font-size: 1rem; width: 100%; }
    .input-area input:focus { outline: none; }
    
    .weight-chart-container { background: var(--surface-color); border-radius: 18px; padding: 20px; margin-top: 30px; box-shadow: 0 4px 12px var(--shadow-color); }
    .weight-chart-container .line { fill: none; stroke: var(--primary-color); stroke-width: 2.5; transition: stroke-dashoffset 2s cubic-bezier(0.47, 0, 0.745, 0.715); }
    .weight-chart-container .point { fill: var(--primary-color); stroke: var(--surface-color); stroke-width: 2; }
    .weight-chart-container .grid { stroke: var(--border-color); }
    .weight-chart-container .label { fill: var(--on-surface-variant); font-size: 11px; }
    .weight-chart-container .no-data { text-align: center; color: var(--on-surface-variant); padding: 40px 0; }

    /* Modal Styling */
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 1000; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
    .modal-overlay.visible { opacity: 1; pointer-events: auto; }
    .modal-content { background: var(--surface-color); padding: 25px; border-radius: 18px; width: 90%; max-width: 400px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); transform: scale(0.9); transition: transform 0.3s ease; }
    .modal-overlay.visible .modal-content { transform: scale(1); }
    .modal-content h3 { margin: 0 0 20px 0; font-size: 1.5rem; text-align: center; }
    .modal-content .form-group { margin-bottom: 15px; }
    .modal-content label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--on-surface-variant); }
    .modal-content input { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid var(--border-color); background: var(--bg-color); font-size: 1rem; color: var(--on-surface-color); }
    .modal-buttons { display: flex; gap: 10px; margin-top: 25px; }
    .modal-btn { flex: 1; padding: 12px; border-radius: 10px; border: none; font-size: 1rem; font-weight: 700; cursor: pointer; transition: background 0.2s; }
    .modal-btn.primary { background: var(--primary-color); color: white; }
    .modal-btn.secondary { background: var(--bg-color); color: var(--on-surface-color); border: 1px solid var(--border-color); }

  </style>
</head>
<body>

  <div class="container" id="app-container">
    <header class="main-header">
        <div id="theme-switcher" class="theme-switcher">
            <i class="ph-bold ph-moon"></i><i class="ph-bold ph-sun"></i>
        </div>
        <div class="weight-display-card">
            <div class="weight-card-label">
                <i class="ph-bold ph-scales"></i>
                <span>آخر وزن مسجل</span>
            </div>
            <div class="weight-card-main">
                <span id="currentWeightDisplay" class="value">--</span>
                <span class="unit">كجم</span>
            </div>
        </div>
    </header>

    <div class="selectors-container">
        <div class="week-selector" id="week-selector"></div>
        <div class="day-selector" id="day-selector"></div>
    </div>
    <div id="day-content-area"></div>
    
    <div class="weight-chart-container">
        <h3 class="section-title"><i class="ph-bold ph-chart-line-up"></i>تطور الوزن</h3>
        <div id="weight-chart"></div>
    </div>
  </div>
  
  <div id="settings-modal" class="modal-overlay">
      <div class="modal-content">
          <h3>الإعدادات</h3>
          <div class="form-group">
              <label for="water-goal-input">هدف الماء اليومي (مل)</label>
              <input type="number" id="water-goal-input" placeholder="مثال: 3000">
          </div>
          <div class="modal-buttons">
              <button id="modal-cancel" class="modal-btn secondary">إلغاء</button>
              <button id="modal-save" class="modal-btn primary">حفظ</button>
          </div>
      </div>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
        const WEEKS = 4;
        const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
        const englishDayAbbr = { sunday: "الأحد", monday: "الاثنين", tuesday: "الثلاثاء", wednesday: "الأربعاء", thursday: "الخميس", friday: "الجمعة", saturday: "السبت" };
        
        const dailyQuotes = {
            sunday: "البداية القوية تصنع النهاية العظيمة.",
            monday: "كل خطوة اليوم هي إنجاز الغد.",
            tuesday: "لا تتوقف عندما تتعب، توقف عندما تنتهي.",
            wednesday: "منتصف الأسبوع، دفعة إضافية من الإصرار!",
            thursday: "قليل دائم خير من كثير منقطع.",
            friday: "استمر، فالنسخة الأفضل منك تنتظرك.",
            saturday: "الراحة جزء من القوة، استعد للأسبوع القادم."
        };

        const programData = {
          week1: {
            sunday: { workouts: [{name: "Chest Press (جهاز)", link:"https://www.youtube.com/results?search_query=Dumbbell+Curl+tutorial8"}, {name: "Pec Deck (تفتيح صدر)", link:"https://www.youtube.com/results?search_query=Dumbbell+Curl+tutorial9"}, {name: "Triceps Pushdown", link:"https://www.youtube.com/results?search_query=Shoulder+Press+machine+tutorial0"}, {name: "كارديو: 20 دقيقة مشي سريع أو Elliptical", link:"https://www.youtube.com/results?search_query=Shoulder+Press+machine+tutorial1"}], meals: ["فطور: 2 بيض + توست أسمر + خيار (350 cal)", "سناك: 6 حبات لوز (100 cal)", "غداء: دجاج 150 جم + رز 90 جم + خضار (600 cal)", "سناك: تفاحة (100 cal)", "عشاء: تونة + خس + توست (400 cal)"] },
            monday: { workouts: [{name: "Leg Curl", link:"https://www.youtube.com/results?search_query=Shoulder+Press+machine+tutorial2"}, {name: "Leg Extension", link:"https://www.youtube.com/results?search_query=Shoulder+Press+machine+tutorial3"}, {name: "Glute Kickback", link:"https://www.youtube.com/results?search_query=Shoulder+Press+machine+tutorial4"}, {name: "كارديو: دراجة 20 دقيقة", link:"https://www.youtube.com/results?search_query=Shoulder+Press+machine+tutorial5"}], meals: ["فطور: شوفان 30 جم + حليب قليل دسم + موزة صغيرة (350 cal)", "سناك: زبادي قليل دسم (100 cal)", "غداء: لحم 120 جم + بطاطس 150 جم + خضار (600 cal)", "سناك: خيار + قهوة سوداء (100 cal)", "عشاء: زبادي بروتين + خس (400 cal)"] },
            tuesday: { workouts: [{name: "Lat Pulldown", link:"https://www.youtube.com/results?search_query=Shoulder+Press+machine+tutorial6"}, {name: "Seated Row", link:"https://www.youtube.com/results?search_query=Shoulder+Press+machine+tutorial7"}, {name: "Dumbbell Curl", link:"https://www.youtube.com/results?search_query=Shoulder+Press+machine+tutorial8"}, {name: "Shoulder Press", link:"https://www.youtube.com/results?search_query=Shoulder+Press+machine+tutorial9"}, {name: "كارديو: 20 دقيقة مشي سريع", link:"https://www.youtube.com/results?search_query=Shoulder+Press+machine+tutorial1"}], meals: ["فطور: 2 بيض + توست أسمر + طماطم (350 cal)", "سناك: قهوة + تمرتين (100 cal)", "غداء: سمك مشوي 150 جم + رز 1/2 كوب + سلطة (600 cal)", "سناك: زبادي قليل دسم (100 cal)", "عشاء: بيضتين + خس (400 cal)"] },
            wednesday: { workouts: [{name: "HIIT Elliptical: 20 دقيقة", link:"https://www.youtube.com/results?search_query=HIIT+Elliptical+workout0"}, {name: "Plank", link:"https://www.youtube.com/results?search_query=HIIT+Elliptical+workout1"}, {name: "Russian Twist", link:"https://www.youtube.com/results?search_query=HIIT+Elliptical+workout2"}, {name: "Bicycle Crunch", link:"https://www.youtube.com/results?search_query=HIIT+Elliptical+workout3"}], meals: ["فطور: زبادي بروتين + شوفان + قرفة (350 cal)", "سناك: موزة صغيرة (100 cal)", "غداء: دجاج 150 جم + خضار + رز 1/2 كوب (600 cal)", "سناك: خيار + قهوة (100 cal)", "عشاء: بيضتين + توست أسمر + خس (400 cal)"] },
            thursday: { workouts: [{name: "مشي 30 دقيقة", link:"https://www.youtube.com/results?search_query=HIIT+Elliptical+workout4"}], meals: ["فطور: 2 بيض + توست أسمر + خيار (350 cal)", "سناك: 6 حبات لوز (100 cal)", "غداء: دجاج 150 جم + رز 90 جم + خضار (600 cal)", "سناك: تفاحة (100 cal)", "عشاء: تونة + خس + توست (400 cal)"] },
            friday: { workouts: [{name: "تمرين منزلي خفيف أو راحة", link:"https://www.youtube.com/results?search_query=HIIT+Elliptical+workout5"}], meals: ["فطور: شوفان 30 جم + حليب قليل دسم + موزة صغيرة (350 cal)", "سناك: زبادي قليل دسم (100 cal)", "غداء: لحم 120 جم + بطاطس 150 جم + خضار (600 cal)", "سناك: خيار + قهوة سوداء (100 cal)", "عشاء: زبادي بروتين + خس (400 cal)"] },
            saturday: { workouts: [], meals: ["فطور متوسط تحبه (400 cal)", "غداء مشوي من برّا بدون دهون أو رز كثير (700 cal)", "عشاء خفيف (زبادي أو تونة) (400 cal)"] }
          },
           week2: {
            sunday: { workouts: [{name: "Bench Press (جهاز أو بار)", link:"https://www.youtube.com/results?search_query=HIIT+Elliptical+workout6"}, {name: "Dumbbell Fly", link:"https://www.youtube.com/results?search_query=HIIT+Elliptical+workout7"}, {name: "Triceps Rope Pushdown", link:"https://www.youtube.com/results?search_query=HIIT+Elliptical+workout8"}, {name: "كارديو: 25 دقيقة Elliptical أو مشي سريع", link:"https://www.youtube.com/results?search_query=HIIT+Elliptical+workout9"}], meals: ["فطور: 2 بيض + توست أسمر + خيار (350 cal)", "سناك: 10 لوز (100 cal)", "غداء: دجاج 150 جم + رز 1/2 كوب + خضار (600 cal)", "سناك: زبادي قليل الدسم (100 cal)", "عشاء: تونة بدون زيت + خس + توست (400 cal)"] },
            monday: { workouts: [{name: "Leg Press (خفيف)", link:"https://www.youtube.com/results?search_query=Plank+exercise+tutorial0"}, {name: "Leg Curl", link:"https://www.youtube.com/results?search_query=Shoulder+Press+machine+tutorial2"}, {name: "Hip Thrust", link:"https://www.youtube.com/results?search_query=Plank+exercise+tutorial1"}, {name: "كارديو: دراجة 25 دقيقة", link:"https://www.youtube.com/results?search_query=Plank+exercise+tutorial2"}], meals: ["فطور: شوفان 30 جم + حليب قليل دسم + موزة (350 cal)", "سناك: تمرتين + قهوة (100 cal)", "غداء: لحم 120 جم + بطاطا مشوية 150 جم + خضار (600 cal)", "سناك: تفاحة (100 cal)", "عشاء: زبادي بروتين + خيار (400 cal)"] },
            tuesday: { workouts: [{name: "Lat Pulldown", link:"https://www.youtube.com/results?search_query=Shoulder+Press+machine+tutorial6"}, {name: "Seated Row", link:"https://www.youtube.com/results?search_query=Shoulder+Press+machine+tutorial7"}, {name: "Barbell Curl", link:"https://www.youtube.com/results?search_query=Plank+exercise+tutorial3"}, {name: "Shoulder Dumbbell Press", link:"https://www.youtube.com/results?search_query=Plank+exercise+tutorial4"}, {name: "كارديو: 25 دقيقة مشي", link:"https://www.youtube.com/results?search_query=Plank+exercise+tutorial5"}], meals: ["فطور: بيضتين + توست + طماطم (350 cal)", "سناك: زبادي قليل دسم + 5 حبات لوز (100 cal)", "غداء: سمك 150 جم + رز 1/2 كوب + سلطة (600 cal)", "سناك: خيار + قهوة (100 cal)", "عشاء: تونة + خس + توست (400 cal)"] },
            wednesday: { workouts: [{name: "HIIT: Elliptical 25 دقيقة", link:"https://www.youtube.com/results?search_query=Plank+exercise+tutorial6"}, {name: "Plank: 3 × 30 ثانية", link:"https://www.youtube.com/results?search_query=HIIT+Elliptical+workout1"}, {name: "Russian Twist: 40 تكرار", link:"https://www.youtube.com/results?search_query=HIIT+Elliptical+workout2"}, {name: "Bicycle Crunch: 40 تكرار", link:"https://www.youtube.com/results?search_query=HIIT+Elliptical+workout3"}], meals: ["فطور: زبادي بروتين + شوفان + قرفة (350 cal)", "سناك: موزة صغيرة (100 cal)", "غداء: دجاج 150 جم + خضار + رز 1/2 كوب (600 cal)", "سناك: قهوة + خيارتين (100 cal)", "عشاء: بيضتين + توست أسمر + خس (400 cal)"] },
            thursday: { workouts: [{name: "كارديو فقط: مشي 30 دقيقة", link:"https://www.youtube.com/results?search_query=HIIT+Elliptical+workout4"}, {name: "أو تمرين منزلي خفيف", link:"https://www.youtube.com/results?search_query=HIIT+Elliptical+workout5"}], meals: ["(نفس يوم الأحد تمامًا)"]},
            friday: { workouts: [{name: "HIIT منزلي (Jumping jacks + squats)", link:"https://www.youtube.com/results?search_query=Plank+exercise+tutorial7"}, {name: "أو مشي 20 دقيقة", link:"https://www.youtube.com/results?search_query=Plank+exercise+tutorial8"}], meals: ["فطور: شوفان + لبن قليل دسم (350 cal)", "سناك: مكعب جبن أو تمرتين (100 cal)", "غداء: لحم أو دجاج + رز بني + سلطة (650 cal)", "سناك: قهوة + خيار (100 cal)", "عشاء: زبادي بروتين (400 cal)"] },
            saturday: { workouts: [], meals: ["فطور مفتوح مدروس (فول + بيض + خبز بر = 400–450 cal)", "غداء مشوي بدون دهون (600–700 cal)", "عشاء خفيف جدًا (300 cal)"] }
          },
          week3: {
            sunday: { workouts: [{name: "Dumbbell Bench Press", link:"https://www.youtube.com/results?search_query=Plank+exercise+tutorial9"}, {name: "Incline Chest Press (جهاز)", link:"https://www.youtube.com/results?search_query=Russian+Twist+exercise0"}, {name: "Skull Crushers (ترايسبس)", link:"https://www.youtube.com/results?search_query=Russian+Twist+exercise1"}, {name: "كارديو: 25 دقيقة مشي سريع أو Elliptical", link:"https://www.youtube.com/results?search_query=Russian+Twist+exercise2"}], meals: ["فطور: 2 بيض + توست + خيار وطماطم (350 cal)", "سناك: 6 لوز (100 cal)", "غداء: دجاج 150 جم + 1/4 كوب رز + خضار (550 cal)", "سناك: زبادي قليل الدسم (100 cal)", "عشاء: تونة + خس + توست أسمر (400 cal)"] },
            monday: { workouts: [{name: "Leg Curl", link:"https://www.youtube.com/results?search_query=Shoulder+Press+machine+tutorial2"}, {name: "Step-ups (بدون وزن)", link:"https://www.youtube.com/results?search_query=Russian+Twist+exercise3"}, {name: "Glute Kickbacks", link:"https://www.youtube.com/results?search_query=Russian+Twist+exercise4"}, {name: "كارديو: دراجة ثابتة 25 دقيقة", link:"https://www.youtube.com/results?search_query=Plank+exercise+tutorial2"}], meals: ["فطور: شوفان 30 جم + لبن قليل دسم + قرفة (350 cal)", "سناك: تمرتين (80 cal)", "غداء: لحم 120 جم + بطاطا مشوية 100 جم + سلطة (600 cal)", "سناك: تفاحة (100 cal)", "عشاء: زبادي بروتين + خيار (400 cal)"] },
            tuesday: { workouts: [{name: "Lat Pulldown", link:"https://www.youtube.com/results?search_query=Shoulder+Press+machine+tutorial6"}, {name: "T-Bar Row", link:"https://www.youtube.com/results?search_query=Russian+Twist+exercise5"}, {name: "Hammer Curl", link:"https://www.youtube.com/results?search_query=Russian+Twist+exercise6"}, {name: "Lateral Raise", link:"https://www.youtube.com/results?search_query=Russian+Twist+exercise7"}, {name: "كارديو: 20 دقيقة مشي سريع", link:"https://www.youtube.com/results?search_query=Russian+Twist+exercise8"}], meals: ["فطور: بيضتين + شريحتين توست أسمر (350 cal)", "سناك: زبادي خفيف + 5 لوز (100 cal)", "غداء: سمك 150 جم + رز 1/4 كوب + خضار (550 cal)", "سناك: خيار + قهوة (100 cal)", "عشاء: علبة تونة + خس (400 cal)"] },
            wednesday: { workouts: [{name: "HIIT 25 دقيقة (مشي سريع + بطيء متبادل)", link:"https://www.youtube.com/results?search_query=Russian+Twist+exercise9"}, {name: "Plank", link:"https://www.youtube.com/results?search_query=HIIT+Elliptical+workout1"}, {name: "Leg Raises", link:"https://www.youtube.com/results?search_query=Bicycle+Crunch+exercise0"}, {name: "Mountain Climbers", link:"https://www.youtube.com/results?search_query=Bicycle+Crunch+exercise1"}], meals: ["فطور: زبادي بروتين + ملعقة شوفان + قرفة (350 cal)", "سناك: موزة صغيرة (100 cal)", "غداء: دجاج 150 جم + خضار + بطاطا (550 cal)", "سناك: قهوة + خيارتين (100 cal)", "عشاء: بيضتين + خس + ملعقة شوفان (400 cal)"] },
            thursday: { workouts: [{name: "كارديو فقط: مشي 30 دقيقة", link:"https://www.youtube.com/results?search_query=HIIT+Elliptical+workout4"}, {name: "Stretching 15 دقيقة", link:"https://www.youtube.com/results?search_query=Bicycle+Crunch+exercise2"}], meals: ["مثل يوم الأحد، لكن بدون رز (استبدله بخضار إضافية)"] },
            friday: { workouts: [{name: "15 دقيقة Stair Climber أو سلالم", link:"https://www.youtube.com/results?search_query=Bicycle+Crunch+exercise3"}, {name: "تمارين منزلية قوية (Bodyweight)", link:"https://www.youtube.com/results?search_query=Bicycle+Crunch+exercise4"}], meals: ["فطور: شوفان + زبادي (350 cal)", "غداء: دجاج + خضار فقط (500 cal)", "عشاء: زبادي بروتين + مكعب جبن لايت (400 cal)"] },
            saturday: { workouts: [], meals: ["فطور حر (بيض + خبز بر + فول = 400–450 cal)", "غداء مشوي + خضار فقط (600–650 cal)", "عشاء: خفيف جدًا (زبادي أو تونة)"] }
          },
          week4: {
            sunday: { workouts: [{name: "Dumbbell Chest Press", link:"https://www.youtube.com/results?search_query=Plank+exercise+tutorial9"}, {name: "Cable Crossover", link:"https://www.youtube.com/results?search_query=Bicycle+Crunch+exercise5"}, {name: "Triceps Overhead Extension", link:"https://www.youtube.com/results?search_query=Bicycle+Crunch+exercise6"}, {name: "كارديو: 30 دقيقة مشي سريع أو HIIT", link:"https://www.youtube.com/results?search_query=Bicycle+Crunch+exercise7"}], meals: ["فطور: 2 بيض + توست + خس (350 cal)", "سناك: 6 لوز (100 cal)", "غداء: دجاج 150 جم + خضار فقط (500 cal)", "سناك: زبادي لايت (100 cal)", "عشاء: تونة بدون رز + خس (400 cal)"] },
            monday: { workouts: [{name: "Leg Curl", link:"https://www.youtube.com/results?search_query=Shoulder+Press+machine+tutorial2"}, {name: "Reverse Lunges بدون وزن", link:"https://www.youtube.com/results?search_query=Bicycle+Crunch+exercise8"}, {name: "Glute Kickbacks", link:"https://www.youtube.com/results?search_query=Russian+Twist+exercise4"}, {name: "كارديو: Stair Climber أو دراجة 25 دقيقة", link:"https://www.youtube.com/results?search_query=Bicycle+Crunch+exercise9"}], meals: ["فطور: شوفان 25 جم + زبادي لايت + قرفة (300 cal)", "سناك: تمرتين أو 5 لوز (100 cal)", "غداء: لحم 120 جم + خضار فقط (500 cal)", "سناك: تفاحة أو خيار (100 cal)", "عشاء: زبادي بروتين + شريحة جبن لايت (400 cal)"] },
            tuesday: { workouts: [{name: "Lat Pulldown", link:"https://www.youtube.com/results?search_query=Shoulder+Press+machine+tutorial6"}, {name: "Cable Row", link:"https://www.youtube.com/results?search_query=30+minute+walk0"}, {name: "Dumbbell Curl", link:"https://www.youtube.com/results?search_query=Shoulder+Press+machine+tutorial8"}, {name: "Lateral Raises", link:"https://www.youtube.com/results?search_query=Russian+Twist+exercise7"}, {name: "كارديو: 25 دقيقة HIIT متبدّل السرعة", link:"https://www.youtube.com/results?search_query=30+minute+walk1"}], meals: ["فطور: بيضتين + توست + خيار (300 cal)", "سناك: زبادي أو 5 لوز (100 cal)", "غداء: سمك 150 جم + خضار (500 cal)", "سناك: قهوة سوداء + خيار (50 cal)", "عشاء: تونة أو زبادي (400 cal)"] },
            wednesday: { workouts: [{name: "HIIT على الدراجة أو المشي السريع 30 دقيقة", link:"https://www.youtube.com/results?search_query=30+minute+walk2"}, {name: "Plank", link:"https://www.youtube.com/results?search_query=HIIT+Elliptical+workout1"}, {name: "Leg Raises", link:"https://www.youtube.com/results?search_query=Bicycle+Crunch+exercise0"}, {name: "Russian Twist", link:"https://www.youtube.com/results?search_query=HIIT+Elliptical+workout2"}], meals: ["فطور: زبادي بروتين + ملعقة شوفان (300 cal)", "سناك: تفاحة أو تمرتين (100 cal)", "غداء: دجاج + خضار بدون كارب (500 cal)", "سناك: قهوة سوداء (0 cal)", "عشاء: زبادي بروتين أو تونة (400 cal)"] },
            thursday: { workouts: [{name: "كارديو فقط 30 دقيقة مشي", link:"https://www.youtube.com/results?search_query=HIIT+Elliptical+workout4"}, {name: "تمرين خفيف منزلي (اختياري)", link:"https://www.youtube.com/results?search_query=HIIT+Elliptical+workout5"}], meals: ["نفس الثلاثاء بالضبط"] },
            friday: { workouts: [{name: "HIIT خفيف أو مشي طويل (45 دقيقة)", link:"https://www.youtube.com/results?search_query=30+minute+walk3"}], meals: ["نفس يوم الأربعاء"] },
            saturday: { workouts: [], meals: ["فطور خفيف وممتع (بيض + جبن + خبز بر = 400 cal)", "غداء تحبه لكن مشوي (700 cal)", "عشاء زبادي أو شوربة خفيفة (400 cal)"] }
          }
        };

      const App = {
        state: {
            activeWeek: 'week1', activeDay: 'sunday', appData: {},
            settings: { waterGoal: 3000, theme: 'light' }
        },
        elements: {
            container: document.getElementById('app-container'),
            currentWeightDisplay: document.getElementById('currentWeightDisplay'),
            selectorsContainer: document.querySelector('.selectors-container'),
            dayContentArea: document.getElementById('day-content-area'),
            weekSelector: document.getElementById('week-selector'),
            daySelector: document.getElementById('day-selector'),
            weightChart: document.getElementById('weight-chart'),
            themeSwitcher: document.getElementById('theme-switcher'),
            settingsModal: {
                overlay: document.getElementById('settings-modal'),
                content: document.querySelector('.modal-content'),
                waterGoalInput: document.getElementById('water-goal-input'),
                saveBtn: document.getElementById('modal-save'),
                cancelBtn: document.getElementById('modal-cancel')
            }
        },
        init() {
            this.loadData(); this.applyTheme(); this.renderSelectors(); this.addEventListeners();
            const todayDayName = days[new Date().getDay()];
            const lastWeek = localStorage.getItem('gymTrackerData_v2_lastWeek') || 'week1';
            this.setActiveState(lastWeek, todayDayName, true);
        },
        loadData() {
            const savedData = localStorage.getItem('gymTrackerData_v2_data');
            this.state.appData = savedData ? JSON.parse(savedData) : {};
            const savedSettings = localStorage.getItem('gymTrackerData_v2_settings');
            if (savedSettings) { this.state.settings = { ...this.state.settings, ...JSON.parse(savedSettings) }; }
            for (let i = 1; i <= WEEKS; i++) {
                const weekKey = `week${i}`; if (!this.state.appData[weekKey]) this.state.appData[weekKey] = {};
                days.forEach(day => {
                    const dayProgram = programData[weekKey]?.[day] || { workouts: [], meals: [] };
                    const workoutCount = dayProgram.workouts.length;
                    if (!this.state.appData[weekKey][day] || !this.state.appData[weekKey][day].hasOwnProperty('waterHistory') || this.state.appData[weekKey][day].workouts.length !== workoutCount) {
                         this.state.appData[weekKey][day] = { workouts: Array(dayProgram.workouts.length).fill(false), meals: Array(dayProgram.meals.length).fill(false), waterHistory: [], weight: '' };
                    }
                });
            }
        },
        saveData() {
            localStorage.setItem('gymTrackerData_v2_data', JSON.stringify(this.state.appData));
            localStorage.setItem('gymTrackerData_v2_settings', JSON.stringify(this.state.settings));
            localStorage.setItem('gymTrackerData_v2_lastWeek', this.state.activeWeek);
            this.updateLatestWeightDisplay(); this.renderWeightChart();
        },
        applyTheme() { document.documentElement.className = this.state.settings.theme; },
        toggleTheme() {
            this.state.settings.theme = this.state.settings.theme === 'light' ? 'dark' : 'light';
            this.applyTheme(); this.saveData();
        },
        renderSelectors() {
            this.elements.weekSelector.innerHTML = Array.from({length: WEEKS}, (_, i) => `<button class="week-btn" data-week="week${i + 1}">الأسبوع ${i + 1}</button>`).join('');
            this.elements.daySelector.innerHTML = days.map(day => `
                <button class="day-btn" data-day="${day}">
                    <span class="day-name">${englishDayAbbr[day]}</span>
                    <div class="day-progress"><div class="day-progress-bar"></div></div>
                </button>`).join('');
        },
        generateDayContentHTML(week, day) {
            const dayProgram = programData[week]?.[day]; if (!dayProgram) return '<p>لا توجد بيانات لهذا اليوم.</p>';
            const workoutsHTML = dayProgram.workouts.map((task, i) => this.createTaskCardHTML('workouts', i, task)).join('');
            const mealsHTML = dayProgram.meals.map((task, i) => this.createTaskCardHTML('meals', i, task)).join('');
            const quote = dailyQuotes[day] || '';
            return `<div class="day-content"><p class="motivational-quote">${quote}</p><div class="section-title"><i class="ph-bold ph-barbell"></i>التمارين</div>${workoutsHTML||'<p>لا توجد تمارين لهذا اليوم.</p>'}<div class="section-title"><i class="ph-bold ph-bowl-food"></i>الوجبات</div>${mealsHTML||'<p>لا توجد وجبات لهذا اليوم.</p>'}<div class="section-title"><i class="ph-bold ph-drop"></i>شرب الماء<button class="settings-btn" data-action="open-settings" style="margin-right:auto;background:none;border:none;color:var(--on-surface-variant);cursor:pointer;font-size:1.3rem;"><i class="ph-bold ph-gear"></i></button></div><div class="options-grid"><button class="option-btn" data-action="add-water" data-amount="200">+ ٢٠٠ مل</button><button class="option-btn" data-action="add-water" data-amount="330">+ ٣٣٠ مل</button><button class="option-btn" data-action="add-water" data-amount="550">+ ٥٥٠ مل</button><button class="option-btn reset-btn" data-action="undo-water"><i class="ph-bold ph-arrow-u-up-left"></i> تراجع</button></div><div class="water-progress-container"><div class="water-progress"><div class="water-text"></div><div class="water-fill"></div></div></div><div class="section-title"><i class="ph-bold ph-scales"></i>تسجيل الوزن</div><div class="input-area"><i class="ph-bold ph-trend-up"></i><input type="number" step="0.1" placeholder="أدخل وزنك اليوم (كجم)..." /></div></div>`;
        },
        createTaskCardHTML(type, index, task) {
            const isWorkout = typeof task === 'object';
            const text = isWorkout ? task.name : task;
            const linkHTML = isWorkout ? `<a href="https://www.youtube.com/results?search_query=30+minute+walk4{encodeURIComponent(task.name)}" target="_blank" class="workout-link" onClick="event.stopPropagation()"><i class="ph-bold ph-youtube-logo"></i></a>` : '';
            return `<div class="card" data-type="${type}" data-index="${index}"><label><input type="checkbox"/><span>${text}</span>${linkHTML}</label></div>`;
        },
        renderDayContent() { const { activeWeek, activeDay } = this.state; this.elements.dayContentArea.innerHTML = this.generateDayContentHTML(activeWeek, activeDay); this.updateUIForDay(activeWeek, activeDay); },
        updateUIForDay(week, day) {
            const dayData = this.state.appData[week]?.[day]; if (!dayData) return;
            const content = this.elements.dayContentArea.querySelector('.day-content'); if (!content) return;
            ['workouts', 'meals'].forEach(type => { dayData[type].forEach((isChecked, i) => { const card = content.querySelector(`.card[data-type='${type}'][data-index='${i}']`); if(card){ card.querySelector('input').checked = isChecked; card.classList.toggle('completed', isChecked); } }); });
            const totalWater = dayData.waterHistory.reduce((a, b) => a + b, 0); const waterGoal = this.state.settings.waterGoal; const percentage = Math.min((totalWater / waterGoal) * 100, 100);
            const waterProgress = content.querySelector('.water-progress'); waterProgress.querySelector('.water-fill').style.width = `${percentage}%`; waterProgress.querySelector('.water-text').textContent = `${totalWater} / ${waterGoal} مل`;
            waterProgress.classList.toggle('completed', percentage >= 100);
            content.querySelector('input[type="number"]').value = dayData.weight; this.updateDayProgressIndicator(week, day);
        },
        updateAllDayProgressIndicators(week) { days.forEach(day => this.updateDayProgressIndicator(week, day)); },
        updateDayProgressIndicator(week, day) {
            const dayData = this.state.appData[week]?.[day]; if(!dayData) return;
            const dayProgram = programData[week]?.[day] || {workouts:[], meals:[]};
            const dayBtn = this.elements.daySelector.querySelector(`.day-btn[data-day='${day}']`); if(!dayBtn) return;
            
            const totalTasks = dayProgram.workouts.length + dayProgram.meals.length;
            const completedTasks = dayData.workouts.filter(Boolean).length + dayData.meals.filter(Boolean).length;
            const progress = totalTasks > 0 ? (completedTasks / totalTasks) * 100 : (dayProgram.meals.length > 0 ? 0 : 100); 
            dayBtn.querySelector('.day-progress-bar').style.width = `${progress}%`;

            const allTasksDone = completedTasks === totalTasks;
            const waterGoal = this.state.settings.waterGoal;
            const totalWater = dayData.waterHistory.reduce((a, b) => a + b, 0);
            const waterGoalMet = totalWater >= waterGoal;

            dayBtn.classList.toggle('day-fully-completed', allTasksDone && waterGoalMet && totalTasks > 0);
        },
        updateLatestWeightDisplay() {
            let latestWeight = null;
            let found = false;
            for (let i = WEEKS; i >= 1 && !found; i--) {
                const weekKey = `week${i}`;
                for (let j = days.length - 1; j >= 0 && !found; j--) {
                    const dayKey = days[j];
                    const weight = this.state.appData[weekKey]?.[dayKey]?.weight;
                    if (weight && String(weight).trim() !== '') {
                        latestWeight = weight;
                        found = true;
                    }
                }
            }
             this.elements.currentWeightDisplay.textContent = latestWeight ? parseFloat(latestWeight).toFixed(1) : '--';
        },
        renderWeightChart() {
            const weightData = []; let dayIndex = 0;
            for (let i = 1; i <= WEEKS; i++) { days.forEach(dayKey => { const weight = this.state.appData[`week${i}`]?.[dayKey]?.weight; if (weight && String(weight).trim() !== '') { weightData.push({ day: dayIndex, weight: parseFloat(weight) }); } dayIndex++; }); }
            const chartEl = this.elements.weightChart; if (weightData.length < 2) { chartEl.innerHTML = '<p class="no-data">سجل وزنك ليومين على الأقل لرسم المخطط.</p>'; return; }
            const svgWidth = chartEl.clientWidth; const svgHeight = 200; const margin = { top: 20, right: 20, bottom: 30, left: 40 };
            const width = svgWidth - margin.left - margin.right; const height = svgHeight - margin.top - margin.bottom;
            const weights = weightData.map(d => d.weight); const minWeight = Math.min(...weights) - 2; const maxWeight = Math.max(...weights) + 2;
            const xScale = (day) => margin.left + (day / (WEEKS * 7 - 1)) * width; const yScale = (weight) => margin.top + height - ((weight - minWeight) / (maxWeight - minWeight)) * height;
            const linePath = weightData.map(d => `${xScale(d.day)},${yScale(d.weight)}`).join(' ');
            const gridLines = Array.from({length: 5}, (_, i) => `<line class="grid" x1="${margin.left}" y1="${margin.top + (i/4) * height}" x2="${width + margin.left}" y2="${margin.top + (i/4) * height}"></line>`).join('');
            const yAxisLabels = Array.from({length: 3}, (_, i) => `<text class="label" x="${margin.left - 8}" y="${yScale(minWeight + (i/2) * (maxWeight-minWeight)) + 4}" text-anchor="end">${(minWeight + (i/2) * (maxWeight-minWeight)).toFixed(1)}</text>`).join('');
            chartEl.innerHTML = `<svg viewBox="0 0 ${svgWidth} ${svgHeight}">${gridLines}${yAxisLabels}<polyline class="line" points="${linePath}"></polyline>${weightData.map(d => `<circle class="point" cx="${xScale(d.day)}" cy="${yScale(d.weight)}" r="4"></circle>`).join('')}</svg>`;
            const line = chartEl.querySelector('.line'); if(line) { const length = line.getTotalLength(); line.style.strokeDasharray = length; line.style.strokeDashoffset = length; line.getBoundingClientRect(); line.style.transition = 'stroke-dashoffset 2s cubic-bezier(0.47, 0, 0.745, 0.715)'; line.style.strokeDashoffset = '0'; }
        },
        addEventListeners() {
            this.elements.selectorsContainer.addEventListener('click', (e) => { const w = e.target.closest('.week-btn'), d = e.target.closest('.day-btn'); if (w) this.setActiveState(w.dataset.week, this.state.activeDay); if (d) this.setActiveState(this.state.activeWeek, d.dataset.day); });
            this.elements.dayContentArea.addEventListener('click', (e) => { const btn = e.target.closest('button'); if(btn && btn.dataset.action) this.handleActionClick(btn); });
            this.elements.dayContentArea.addEventListener('input', (e) => { if (e.target.matches('input[type="checkbox"]')) this.handleCheckboxChange(e.target); if (e.target.matches('input[type="number"]')) this.handleWeightChange(e.target); });
            this.elements.themeSwitcher.addEventListener('click', () => this.toggleTheme());
            this.elements.settingsModal.saveBtn.addEventListener('click', () => this.saveSettings());
            this.elements.settingsModal.cancelBtn.addEventListener('click', () => this.toggleModal(false));
            this.elements.settingsModal.overlay.addEventListener('click', (e) => { if(e.target === this.elements.settingsModal.overlay) this.toggleModal(false); });
        },
        setActiveState(week, day, force = false) {
            if (!force && this.state.activeWeek === week && this.state.activeDay === day) return;
            const weekChanged = this.state.activeWeek !== week; this.state.activeWeek = week; this.state.activeDay = day;
            document.querySelectorAll('.week-btn.active').forEach(b => b.classList.remove('active')); document.querySelector(`.week-btn[data-week="${week}"]`).classList.add('active');
            document.querySelectorAll('.day-btn.active').forEach(b => b.classList.remove('active'));
            const newActiveDayBtn = document.querySelector(`.day-btn[data-day="${day}"]`);
            newActiveDayBtn.classList.add('active');
            newActiveDayBtn.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
            if(weekChanged) this.updateAllDayProgressIndicators(week);
            this.renderDayContent(); this.updateLatestWeightDisplay(); this.renderWeightChart();
        },
        handleActionClick(button) {
            const { activeWeek, activeDay } = this.state; const dayData = this.state.appData[activeWeek][activeDay]; const action = button.dataset.action;
            if (action === 'add-water') { dayData.waterHistory.push(parseInt(button.dataset.amount)); } else if (action === 'undo-water') { dayData.waterHistory.pop(); } else if (action === 'open-settings') { this.toggleModal(true); }
            this.saveData(); this.updateUIForDay(activeWeek, activeDay);
        },
        handleCheckboxChange(checkbox) {
            const { activeWeek, activeDay } = this.state; const card = checkbox.closest('.card'); const { type, index } = card.dataset;
            this.state.appData[activeWeek][activeDay][type][index] = checkbox.checked;
            this.saveData(); this.updateUIForDay(activeWeek, activeDay);
        },
        handleWeightChange(input) { const { activeWeek, activeDay } = this.state; this.state.appData[activeWeek][activeDay].weight = input.value; this.saveData(); },
        toggleModal(visible) {
            const { overlay, waterGoalInput } = this.elements.settingsModal;
            if(visible) { waterGoalInput.value = this.state.settings.waterGoal; overlay.classList.add('visible'); } else { overlay.classList.remove('visible'); }
        },
        saveSettings() { const newGoal = parseInt(this.elements.settingsModal.waterGoalInput.value); if (newGoal && newGoal > 0) { this.state.settings.waterGoal = newGoal; this.saveData(); this.toggleModal(false); this.updateUIForDay(this.state.activeWeek, this.state.activeDay); } }
      };
      App.init();
    });
  </script>
</body>
</html>